<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>C#实现快捷键(系统热键)响应</title>
<link rel="stylesheet" type="text/css" href="css/style.css" />
<link rel="stylesheet" type="text/css" href="http://wangheng.org/tools/bootstrap/css/bootstrap.min.css" media="all" />
<link rel="stylesheet" type="text/css" href="http://wangheng.org/tools/bootstrap/css/bootstrap-responsive.min.css" media="all" />

<script type="text/javascript" src="http://wangheng.org/tools/js/jquery.min.js"></script>	
<script type="text/javascript" src="http://wangheng.org/tools/bootstrap/js/bootstrap.min.js"></script>	
</head>

<!--<body  onresize="resize()" onorientationchange="resize()" >-->
<body >

<!--<canvas id="star_wangheng" style="background-color:#000000">-->
<!--</canvas>-->

<header id="header">
	<div id="navbar-header" class="navbar navbar-static">
              <div class="navbar-inner" style="">
                <div class="container" style="width: auto;">
                  <a class="brand" href="#">我的笔记</a>
                  <a class="brand" href="http://wangheng.org" target="_blank">》博客 </a>
                  <ul class="nav" role="navigation">
                    <li class="dropdown">
                      <a id="drop1" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">Windows相关 <b class="caret"></b></a>
                      <ul class="dropdown-menu" role="menu" aria-labelledby="drop1">
                        <li><a tabindex="-1" href="windows_modify_route.html">windows修改默认路由</a></li>
                        <li><a tabindex="-1" href="windows_del_svn_folder.html">windows右键清除svn目录</a></li>
                        <li><a tabindex="-1" href="#">...</a></li>
                        <li class="divider"></li>
                        <li><a tabindex="-1" href="windows.html">全部windows笔记</a></li>
                      </ul>
                    </li>
                    <li class="dropdown">
                      <a href="#" id="drop2" role="button" class="dropdown-toggle" data-toggle="dropdown">Linux相关<b class="caret"></b></a>
                      <ul class="dropdown-menu" role="menu" aria-labelledby="drop2">
                        <li><a tabindex="-1" href="linux_basic_command.html">基本命令</a></li>
                        <li><a tabindex="-1" href="Linux_network_setting.html">Linux下的网络设置</a></li>
                        <li><a tabindex="-1" href="create_linux_start_script.html">创建Linux开机启动脚本</a></li>
                        <li class="divider"></li>
                        <li><a tabindex="-1" href="linux.html">查看全部</a></li>
                      </ul>
                    </li>
                  </ul>
                  <ul class="nav pull-right">
                    <li id="fat-menu" class="dropdown">
                      <a href="#" id="drop3" role="button" class="dropdown-toggle" data-toggle="dropdown">功能<b class="caret"></b></a>
                      <ul class="dropdown-menu" role="menu" aria-labelledby="drop3">
                        <li><a tabindex="-1" href="#leave_comments">留言</a></li>
                        <!-- <li><a tabindex="-1" href="#">Another action</a></li>
                        <li><a tabindex="-1" href="#">Something else here</a></li> -->
                        <li class="divider"></li>
                        <li><a tabindex="-1" href="mailto:me@wangheng.org">联系我</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
<!-- <div id="logo" style="font-size: 22pt;text-align:center;"><a href="http://wangheng.org/html/index.html">王恒的笔记</a></div>
 -->
</header>
<div id="wrap">
<div id="content">	


<p>
在应用中，我们可能会需要实现像Ctrl+C复制、Ctrl+V粘贴这样的快捷键，本文简单介绍了它的实现，并给出了一个实现类。
</p>

<h4 id="toc_0.0.0.1">（1）建立一个类文件，命名为HotKey.cs，代码如下：</h4>
<pre class="brush: csharp">
using System;
using System.Collections.Generic;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace KoalaStudio.BookshopManager
{
    class HotKey
    {
        //如果函数执行成功，返回值不为0。
        //如果函数执行失败，返回值为0。要得到扩展错误信息，调用GetLastError。
        [DllImport("user32.dll", SetLastError = true)]
        public static extern bool RegisterHotKey(
            IntPtr hWnd,                //要定义热键的窗口的句柄
            int id,                     //定义热键ID（不能与其它ID重复）           
            KeyModifiers fsModifiers,   //标识热键是否在按Alt、Ctrl、Shift、Windows等键时才会生效
            Keys vk                     //定义热键的内容
            );

        [DllImport("user32.dll", SetLastError = true)]
        public static extern bool UnregisterHotKey(
            IntPtr hWnd,                //要取消热键的窗口的句柄
            int id                      //要取消热键的ID
            );

        //定义了辅助键的名称（将数字转变为字符以便于记忆，也可去除此枚举而直接使用数值）
        [Flags()]
        public enum KeyModifiers
        {
            None = 0,
            Alt = 1,
            Ctrl = 2,
            Shift = 4,
            WindowsKey = 8
        }
    }
}
</pre>

<p>
简单说明一下：
“public static extern bool RegisterHotKey()”这个函数用于注册热键。由于这个函数需要引用user32.dll动态链接库后才能使用，并且
</p>

<p>
user32.dll是非托管代码，不能用命名空间的方式直接引用，所以需要用“DllImport”进行引入后才能使用。于是在函数前面需要加上
</p>

<p>
“[DllImport("user32.dll", SetLastError = true)]”这行语句。
“public static extern bool UnregisterHotKey()”这个函数用于注销热键，同理也需要用DllImport引用user32.dll后才能使用。
“public enum KeyModifiers{}”定义了一组枚举，将辅助键的数字代码直接表示为文字，以方便使用。这样在调用时我们不必记住每一个辅
</p>

<p>
助键的代码而只需直接选择其名称即可。
</p>

<h4 id="toc_0.0.0.2">（2）以窗体FormA为例，介绍HotKey类的使用</h4>

<p>
在FormA的Activate事件中注册热键，本例中注册Shift+S，Ctrl+Z，Alt+D这三个热键。这里的Id号可任意设置，但要保证不被重复。
</p>
<pre class="brush: csharp">
private void Form_Activated(object sender, EventArgs e)
{
    //注册热键Shift+S，Id号为100。HotKey.KeyModifiers.Shift也可以直接使用数字4来表示。
    HotKey.RegisterHotKey(Handle, 100, HotKey.KeyModifiers.Shift, Keys.S); 
    //注册热键Ctrl+B，Id号为101。HotKey.KeyModifiers.Ctrl也可以直接使用数字2来表示。
    HotKey.RegisterHotKey(Handle, 101, HotKey.KeyModifiers.Ctrl, Keys.B);
    //注册热键Alt+D，Id号为102。HotKey.KeyModifiers.Alt也可以直接使用数字1来表示。
    HotKey.RegisterHotKey(Handle, 102, HotKey.KeyModifiers.Alt, Keys.D);
}

在FormA的Leave事件中注销热键。
private void FrmSale_Leave(object sender, EventArgs e)
{
    //注销Id号为100的热键设定
    HotKey.UnregisterHotKey(Handle, 100);
    //注销Id号为101的热键设定
    HotKey.UnregisterHotKey(Handle, 101);// http://ike.126.com
    //注销Id号为102的热键设定
    HotKey.UnregisterHotKey(Handle, 102);
}

重载FromA中的WndProc函数
/// 
/// 监视Windows消息
/// 重载WndProc方法，用于实现热键响应
/// 
/// 
protected override void WndProc(ref Message m)
{
    const int WM_HOTKEY = 0x0312;
    //按快捷键 
    switch (m.Msg)
    {
        case WM_HOTKEY:
            switch (m.WParam.ToInt32())
            {
                case 100:    //按下的是Shift+S
                    //此处填写快捷键响应代码         
                    break;
                case 101:    //按下的是Ctrl+B
                    //此处填写快捷键响应代码
                    break;
                case 102:    //按下的是Alt+D
                    //此处填写快捷键响应代码
                    break;
            }
        break;
    }
    base.WndProc(ref m);
}

</pre>
<p>
完成代码后，我们在窗体中按下Shift+S、Ctrl+B、Alt+D这三组快捷键中的任意一组时，程序都会做出响应的反应。
</p>

</div>

<h2 style="font-size: 18pt">给我留言</h2>

<!-- Duoshuo-->
<div class="ds-thread" data-thread-key=""	data-title="" data-author-key="" data-url=""></div>
</div>

<br />
<!--this is my footer-->
<div id="footer">

<a href="#" rel="alternate" type="application/rss+xml"><img alt="RSS" src="img/rss_button.gif" width="16" height="16" style="border:none" /></a>

<a href="http://wangheng.org" target="_blank"><img border="0" src="img/me.png" alt="By WangHeng" height="48" width="48"></a>

<a href="http://www.vim.org" target="_blank"><img border="0" src="img/created_with_vim.png" alt="Created with Vim" height="36" width="90"></a>

<img alt="知识共享许可协议" height="31" width="80" style="border-width:0" src="img/cc_80x31.png" /> 本作品采用知识共享署名-非商业性使用-禁止演绎 3.0 Unported <a name="license" rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">许可协议</a>进行许可。


</div>


<!--For my star background-->
<!--<script type="text/javascript" src="js/starfield.js"></script>-->
<!--<script type="text/javascript">-->
	<!--start()-->
<!--</script>-->

<!--For code syntax-->
<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushBash.js"></script>
<script type="text/javascript" src="js/shBrushCpp.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>
<script type="text/javascript" src="js/shBrushCss.js"></script>
<script type="text/javascript" src="js/shBrushJava.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushPhp.js"></script>
<script type="text/javascript" src="js/shBrushPython.js"></script>
<script type="text/javascript" src="js/shBrushSql.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>

<link type="text/css" rel="stylesheet" href="css/shCore.css"/>
<link type="text/css" rel="stylesheet" href="css/shCoreMidnight.css"/>
<script type="text/javascript">
SyntaxHighlighter.all();
</script>
<!--加载js-->
<script type="text/javascript" src="js/tools.js"></script>
</body>
</html>

