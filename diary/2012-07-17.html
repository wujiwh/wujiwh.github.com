<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>工作交接文档</title>
<link rel="stylesheet" type="text/css" href="../css/style.css" />
<link rel="stylesheet" type="text/css" href="http://wangheng.org/tools/bootstrap/css/bootstrap.min.css" media="all" />
<link rel="stylesheet" type="text/css" href="http://wangheng.org/tools/bootstrap/css/bootstrap-responsive.min.css" media="all" />

<script type="text/javascript" src="http://wangheng.org/tools/js/jquery.min.js"></script>	
<script type="text/javascript" src="http://wangheng.org/tools/bootstrap/js/bootstrap.min.js"></script>	
</head>

<!--<body  onresize="resize()" onorientationchange="resize()" >-->
<body >

<!--<canvas id="star_wangheng" style="background-color:#000000">-->
<!--</canvas>-->

<header id="header">
	<div id="navbar-header" class="navbar navbar-static">
              <div class="navbar-inner" style="">
                <div class="container" style="width: auto;">
                  <a class="brand" href="#">我的笔记</a>
                  <a class="brand" href="http://wangheng.org" target="_blank">》博客 </a>
                  <ul class="nav" role="navigation">
                    <li class="dropdown">
                      <a id="drop1" href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">Windows相关 <b class="caret"></b></a>
                      <ul class="dropdown-menu" role="menu" aria-labelledby="drop1">
                        <li><a tabindex="-1" href="windows_modify_route.html">windows修改默认路由</a></li>
                        <li><a tabindex="-1" href="windows_del_svn_folder.html">windows右键清除svn目录</a></li>
                        <li><a tabindex="-1" href="#">...</a></li>
                        <li class="divider"></li>
                        <li><a tabindex="-1" href="windows.html">全部windows笔记</a></li>
                      </ul>
                    </li>
                    <li class="dropdown">
                      <a href="#" id="drop2" role="button" class="dropdown-toggle" data-toggle="dropdown">Linux相关<b class="caret"></b></a>
                      <ul class="dropdown-menu" role="menu" aria-labelledby="drop2">
                        <li><a tabindex="-1" href="linux_basic_command.html">基本命令</a></li>
                        <li><a tabindex="-1" href="Linux_network_setting.html">Linux下的网络设置</a></li>
                        <li><a tabindex="-1" href="create_linux_start_script.html">创建Linux开机启动脚本</a></li>
                        <li class="divider"></li>
                        <li><a tabindex="-1" href="linux.html">查看全部</a></li>
                      </ul>
                    </li>
                  </ul>
                  <ul class="nav pull-right">
                    <li id="fat-menu" class="dropdown">
                      <a href="#" id="drop3" role="button" class="dropdown-toggle" data-toggle="dropdown">功能<b class="caret"></b></a>
                      <ul class="dropdown-menu" role="menu" aria-labelledby="drop3">
                        <li><a tabindex="-1" href="#leave_comments">留言</a></li>
                        <!-- <li><a tabindex="-1" href="#">Another action</a></li>
                        <li><a tabindex="-1" href="#">Something else here</a></li> -->
                        <li class="divider"></li>
                        <li><a tabindex="-1" href="mailto:me@wangheng.org">联系我</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
<!-- <div id="logo" style="font-size: 22pt;text-align:center;"><a href="http://wangheng.org/html/index.html">王恒的笔记</a></div>
 -->
</header>
<div id="wrap">
<div id="content">	


<p>
<red><em>部门调整，临走之前对所做工作进行了一些简单的整理。Just For PJ</em></red>
<h1>目录</h1>
<div class="toc">
<ul>
<li><a href="#toc_0.0.1">Google SiteLink</a>
<li><a href="#toc_0.0.2">Facebook添加对新类型ad的支持</a>
<ul>
<li><a href="#toc_0.0.2.1">支持PagePost类型的ad</a>
<li><a href="#toc_0.0.2.2">支持Place一组类型</a>
<li><a href="#toc_0.0.2.3">添加CPM Optimization的支持</a>
</ul>
<li><a href="#toc_0.0.3">GoogleToAdcenter Migration</a>
<li><a href="#toc_0.0.4">Optimization</a>
<li><a href="#toc_0.0.5">汉化</a>
<li><a href="#toc_0.0.6">关于Bugs</a>
<li><a href="#toc_0.0.7">补充</a>
</ul>
</ul>
</ul>
</div>
</p>

<h3 id="toc_0.0.1">Google SiteLink</h3>
<p>
UI部分主要代码位于D:\WorkCopy\trunk\src\Google\AdSage.Concert.Google.SEMObjectEditingApp\Controls\【SiteLinkConfigDialog.cs|SiteLinkControl.cs】
主要功能是为了设置GoogleCampaignProperty.SitelinksExtension这个属性。具体代码位于（GoogleCampaignEditor.cs）的179和191行。 <em>注：应该已经没有bug了</em>
</p>

<h3 id="toc_0.0.2">Facebook添加对新类型ad的支持</h3>
<p>
代码位于FaceBookAdEditor.cs这个代码行数最长的文件。。。
</p>
<h4 id="toc_0.0.2.1">支持PagePost类型的ad</h4>
<p>
大概是上年十月做的吧，当时是为了把那一堆RadioButton换成下拉样式的combox。UI部分的代码不太多，但是cbPagePostSel和txtPagePostCustom这两个控件最初是xiaolin写的，我后来改过很多，但还是有点乱。这里最近wulili还提了一个bug，要combox中显示不全的文字加上Tooltips。。。
</p>

<p>
功能最终是为了设置<code>FacebookAdGroupProperty.StoryId</code>和<code>FacebookAdGroupProperty.AutoUpdate</code>这两个属性。代码在263行左右。
</p>
<pre class="brush: csharp">
	else
	{
		TextEditInPut();
		var post = Posts.FirstOrDefault(item =&gt; item.Value == cbPagePostSel.SelectedItem.ToString());
		SetProperty(FacebookAdGroupProperty.StoryId, post.Key);
		SetProperty(FacebookAdGroupProperty.AutoUpdate, false);
	}
</pre>

<h4 id="toc_0.0.2.2">支持Place一组类型</h4>
<p>
其实只是支持了Place Check In这种类型的ad，CreativeType类型10。现在是根据Facebook web上的样式将Place作为了一组，其中Place分组下共可以编辑5种类型的ads，名称和对应的类型分别如下：
</p>

<table>
<tr>
<th>
名称：
</th>
<th>
CreativeType：
</th>
</tr>
<tr>
<td>
PagePost(默认)
</td>
<td>
27
</td>
</tr>
<tr>
<td>
page
</td>
<td>
2
</td>
</tr>
<tr>
<td>
page like story
</td>
<td>
9
</td>
</tr>
<tr>
<td>
check-in story
</td>
<td>
10
</td>
</tr>
<tr>
<td>
page post like story
</td>
<td>
17
</td>
</tr>
</table>

<p>
<strong>添加新类型需要注意的几个地方</strong>
</p>

<p>
注意修改<code>UpdateTargetingConnections(CreativeType creativeType)</code>这个方法，在代码的1516行左右。用来设置当前类型ad对应的默认的Targeting Connection，不同类型的ad可以设置的内容不太一样，可能需要看一下Facebook Web上的Targeting部分。
</p>

<h4 id="toc_0.0.2.3">添加CPM Optimization的支持</h4>
<p>
UI部分的代码是Wayne 写的，有两个自定义控件在../Facebook/Editing/EditTools这个文件夹。DB部分主要是增加了BidInfo这个字段用于存储FacebookAdGroup序列化的bidinfo这个Dictionary类型属性。
</p>

<p>
添加字段PJ应该也很熟悉了吧:) 我就不多写了。
</p>

<p>
需要注意的地方是在SEMObjectsProvider.Partial.Update.cs这个文件的693行左右添加了一个判断用来使用json序列化，否则用的是默认的XmlEncodingUtility序列化。
</p>

<h3 id="toc_0.0.3">GoogleToAdcenter Migration</h3>
<p>
主要就是对google对象一些属性的提取，然后将值设置到新建的adcenter对象上面。在../Migration/GoogleToAdcenter文件夹下面是不同级别的对象的创建。其中Campaign级别中有个地域的转换用到了一个描述地区信息的xml文件，取的是 <code>AdSage.Concert.AdCenter.SEMObjectEditingApp.Controls.AdCenterLocationsTarget.xml</code>两个文件应该保持一致。
</p>

<p>
<em>这部分很少出现bug了，加上kunlu说adcenter用户很少，所以关注度较低</em>
</p>

<h3 id="toc_0.0.4">Optimization</h3>
<p>
RuleSetManagement是一个单例的类，对RuleSetManagementService 进行了简单的包装然后公开给外面使用。
</p>

<p>
这里面有几个方法容易出异常<code>GetRuleSetInfos(long advertiserId)</code>这个如果取到的结果为null的话，去看一下测试他们连的服务器上面的Scheduler是否在运行，一般都是这个所引发的。
</p>

<p>
更改rule的状态请使用UpdateRuleSetStatus这个方法，虽然使用UpdateRuleSet也能更新状态但是这里使用UpdateRuleSet曾经出过问题。
</p>

<p>
Wizard的代码都在..\Optimization\AdSage.Concert.RulesEngine这个项目里面。
</p>

<p>
其中：<code>Controls</code>文件夹中是一些自定义的控件，预览窗口在<code>RuleBasedOptimization</code>这个文件夹，Wizard四个步骤的dialog都在这里。
</p>

<p>
<code>OptimizationRuleCondition.cs</code>这个文件里面是一些初始化的配置，要配置Wizard中的conditions和actions都从这里配置。
</p>

<h3 id="toc_0.0.5">汉化</h3>
<p>
需要使用SR的项目里面需要添加项目<code>AdSage.Concert.StringManagement</code>的引用，然后将using里面原来的SR命名空间去掉，并使用AdSage.Concert.StringManagement命名空间下面的SR。
</p>

<p>
使用方法是SR.GetString(SR.XXX); 然后记得使用jishi那个SREditor工具在相应的节点添加上字符串的Key ：Value
</p>

<p>
<em>注：提交SR文件，记得Chinese和Default同时提交。</em>
</p>

<h3 id="toc_0.0.6">关于Bugs</h3>
<p>
现在我头上三个bug我是无法重现的，一个可能需要问一下渊总。
</p>
<pre>
无法重现的：
Support #14001 
Support #14000 
Bug #13873
</pre>

<h3 id="toc_0.0.7">补充</h3>
<p>
做的细碎的东西很多，大块的东西都记载这里了，以后有什么能帮上忙的随时联系我吧 :)
</p>
<pre>
Thanks,
WangHeng

Mail: wangheng@adsage.com
Tel:  13552799237
</pre>

</div>

<h2 style="font-size: 18pt">给我留言</h2>

<!-- Duoshuo-->
<div class="ds-thread" data-thread-key=""	data-title="" data-author-key="" data-url=""></div>
</div>

<br />
<!--this is my footer-->
<div id="footer">

<a href="#" rel="alternate" type="application/rss+xml"><img alt="RSS" src="../img/rss_button.gif" width="16" height="16" style="border:none" /></a>

<a href="http://wangheng.org" target="_blank"><img border="0" src="../img/me.png" alt="By WangHeng" height="48" width="48"></a>

<a href="http://www.vim.org" target="_blank"><img border="0" src="../img/created_with_vim.png" alt="Created with Vim" height="36" width="90"></a>

<img alt="知识共享许可协议" height="31" width="80" style="border-width:0" src="../img/cc_80x31.png" /> 本作品采用知识共享署名-非商业性使用-禁止演绎 3.0 Unported <a name="license" rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">许可协议</a>进行许可。


</div>


<!--For my star background-->
<!--<script type="text/javascript" src="../js/starfield.js"></script>-->
<!--<script type="text/javascript">-->
	<!--start()-->
<!--</script>-->

<!--For code syntax-->
<script type="text/javascript" src="../js/shCore.js"></script>
<script type="text/javascript" src="../js/shBrushBash.js"></script>
<script type="text/javascript" src="../js/shBrushCpp.js"></script>
<script type="text/javascript" src="../js/shBrushCSharp.js"></script>
<script type="text/javascript" src="../js/shBrushCss.js"></script>
<script type="text/javascript" src="../js/shBrushJava.js"></script>
<script type="text/javascript" src="../js/shBrushJScript.js"></script>
<script type="text/javascript" src="../js/shBrushPhp.js"></script>
<script type="text/javascript" src="../js/shBrushPython.js"></script>
<script type="text/javascript" src="../js/shBrushSql.js"></script>
<script type="text/javascript" src="../js/shBrushXml.js"></script>

<link type="text/css" rel="stylesheet" href="../css/shCore.css"/>
<link type="text/css" rel="stylesheet" href="../css/shCoreMidnight.css"/>
<script type="text/javascript">
SyntaxHighlighter.all();
</script>
<!--加载js-->
<script type="text/javascript" src="../js/tools.js"></script>
</body>
</html>

